<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadeia Articulada</title>
  <style>
    body {
      margin: 0;
      background: #000;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #000;
    }
  </style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

class Segment {
  constructor(parent, size) {
    this.parent = parent || null;
    this.children = [];
    this.size = size;

    this.x = parent ? parent.x : canvas.width / 2;
    this.y = parent ? parent.y : canvas.height / 2;

    this.absAngle = 0;
    this.relAngle = 0;

    if (parent) {
      parent.children.push(this);
    }
  }

  follow(iter) {
    const x = this.parent.x;
    const y = this.parent.y;

    const dx = this.x - x;
    const dy = this.y - y;
    const dist = Math.pow(dx * dx + dy * dy, 0.5) || 0.0001;

    this.x = x + this.size * dx / dist;
    this.y = y + this.size * dy / dist;

    this.absAngle = Math.atan2(this.y - y, this.x - x);
    this.relAngle = this.absAngle - this.parent.absAngle;

    if (iter) {
      for (let i = 0; i < this.children.length; i++) {
        this.children[i].follow(true);
      }
    }
  }

  draw() {
    if (!this.parent) return;
    ctx.beginPath();
    ctx.moveTo(this.parent.x, this.parent.y);
    ctx.lineTo(this.x, this.y);
    ctx.stroke();
  }
}

// cabeça
const segments = [];
const root = new Segment(null, 0);
root.absAngle = 0;
segments.push(root);

// corpo principal
const numSegments = 25;
const segmentSize = 20;

for (let i = 1; i < numSegments; i++) {
  segments.push(new Segment(segments[i - 1], segmentSize));
}

let targetX = canvas.width / 2;
let targetY = canvas.height / 2;

canvas.addEventListener("mousemove", function (e) {
  const rect = canvas.getBoundingClientRect();
  targetX = e.clientX - rect.left;
  targetY = e.clientY - rect.top;
});

function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.strokeStyle = "#cccccc";
  ctx.lineWidth = 2;

  // cabeça segue o mouse
  root.x = targetX;
  root.y = targetY;

  // atualiza cadeia
  for (let i = 1; i < segments.length; i++) {
    segments[i].follow(true);
  }

  // desenha cadeia
  for (let i = 1; i < segments.length; i++) {
    segments[i].draw();
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
